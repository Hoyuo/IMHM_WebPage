<?xml version="1.0" encoding="UTF-8" ?>
<!DOCTYPE mapper
        PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN"
        "http://mybatis.org/dtd/mybatis-3-mapper.dtd">
<mapper namespace="mybatis/mapper.xml">

    <insert id="register" parameterType="DB.DTO.UserDTO">
        insert into  [dbo].[User]
           ([Username]
           ,[Password]
           ,[UUID]
           ,[LastLogin]
           ,[Nick])
           VALUES
            (#{id},#{pw},'test',getDate(),#{nick});
    </insert>

    <select id="login" parameterType="DB.DTO.UserInfoDTO" resultType="DB.DTO.UserDTO">
SELECT TOP 10 [Id]
      ,[Username]
      ,[Password]
      ,[UUID]
      ,[LastLogin]
      ,[Nick]
  FROM [IHMHdb].[dbo].[User]
  Where [Username]=#{id} And [Password]=#{pw}
    </select>

    <select id="searchImage" resultType="DB.DTO.ImageDTO" parameterType="String">
      SELECT
--        [Id]
--       ,[Title]
--       ,[Artist]
--       ,[AlbumName]
--       ,[Length]
--       ,[Genre]
      [AlbumImage]
--       ,[MetaData]
--       ,[ReleaseDate]
  FROM [IHMHdb].[dbo].[Music]
  where [Id]=#{id}
    </select>

    <select id="test" parameterType="java.lang.String" resultType="DB.DTO.testDTO">
        SELECT
            [Title],
	        [AlbumName]
          FROM [IHMHdb].[dbo].[Music]
          WHERE [Title] =#{Title}
    </select>

    <select id="searchHistory" parameterType="DB.DTO.searchOffsetDTO" resultType="DB.DTO.HistroyDTO" >
    Select   C.Title, C.AlbumName,C.Artist,B.SearchDate,B.Location.Long as Latitude, B.Location.Lat as Longtitude, B.MusicId
     From
     [IHMHdb].[dbo].[User] as A Inner JOIN [IHMHdb].[dbo].[SearchHistory] as B on A.[Id] = B.[UserId]
     Inner Join [IHMHdb].[dbo].[Music] as C on B.MusicId = C.Id

     Where A.Username=#{id} order by B.SearchDate desc
        	OFFSET #{limit} ROWS
	FETCH NEXT #{offset} ROWS ONLY;
    </select>

    <select id="getIdList" parameterType="java.lang.String" resultType="java.lang.String">
    SELECT TOP 1000
      [Username]
    FROM [IHMHdb].[dbo].[User]
    </select>
</mapper>